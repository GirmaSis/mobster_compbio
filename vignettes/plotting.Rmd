---
title: "Plotting mobster fits"
author: "Giulio Caravagna"
date: "September 2019"
institute: "Institute for Cancer Research"
email: "giulio.caravagna@icr.ac.uk"
output: rmarkdown::github_document
vignette: >
  %\VignetteIndexEntry{Plotting mobster fits}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette describes the plotting functions available in [MOBSTER](https://github.com/caravagn/MOBSTER). 

```{r, message=FALSE, warning=F}
library(mobster)
```


```{r, fig.width=5, fig.height=4}
# We load the fit available inside the package
data('fit_example', package = 'mobster')

# Print and plot the model
print(fit_example$best)
plot(fit_example$best)
```

You can plot mutations annotated if the `x`% of probability mass in their maximum responsibility (*hard clustering*) is below a certain cutoff. Non-assigned mutations are 

```{r, fig.width=2.5, fig.height=5}
plot_latent_variables(fit_example$best, cutoff_assignment = .8)
```

You can plot the barplot of the mixing proportions, using the same colour scheme for the fit (here, default).

```{r, fig.width=3, fig.height=3}
plot_mixing_proportions(fit_example$best)
```

The negative log-likelihood of the fit can be plot against the iteration steps, so to check the the trend is decreasing.
```{r, fig.width=3, fig.height=3}
plot_NLL(fit_example$best)
```

A contributor to the NLL is the entropy of the mixture, which can be visualized along with  the reduced entropy, which is used by reICL.
```{r, fig.width=3, fig.height=3}
plot_entropy(fit_example$best)
```


### Selecting alternative best models<a name="alternative"></a>

Alternative models are returned function `mobster_fit`, and can be easly visualized.


```{r, fig.width=15, fig.height=4, message=FALSE, warning=FALSE}
require(ggpubr)

# Figure assembly
figure = ggarrange(
  plot(fit_example$runs[[1]]),
  plot(fit_example$runs[[2]]),
  plot(fit_example$runs[[3]]),
  ncol = 3, nrow = 1
)

print(figure)
```
The table reportin the scores can be visualised, and everal plots are available to inspect model selection.
```{r, fig.width=15, fig.height=4, message=FALSE, warning=FALSE}
print(fit_example$fits.table)
```

One can plot of the sum of squared error (SSE) between the fit density and the data (binned with bins of size 0.01), for several solutions at once. This measure can represent a sort of goodness of fit statistics.

```{r, fig.width=6, fig.height=3}
# Goodness of fit (SSE), for the top 3 fits.
plot_gofit(fit_example, TOP = 3)
```

The scores can also be compared graphically. Running `plot_fit_scores` all the computed scoring functions (BIC, AIC, ICL and reICL) are shown, which helps understanding if the best model with the default score (reICL) is the best also according to the other scores. In this graphics the red dot represents the best model according to each score.
```{r, fig.width=4, fig.height=4}
plot_fit_scores(fit_example)
```


These functions can be all wrapped by a call to `plot_model_selection` which plots the above summary statistics and the fits for each one of a set of top models (change the parameter `TOP` to select how many plots should be computed).
```{r, fig.width=9, fig.height=9, message=FALSE, warning=FALSE, eval=FALSE}
# Not run
plot_model_selection(fit_example, TOP = 5)
```
